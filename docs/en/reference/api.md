# API Reference

This document provides a comprehensive reference for all public APIs in hono-filebased-route.

## Core Package (@hono-filebased-route/core)

The core package provides essential utilities for file-based routing in Hono applications.

### Functions

#### `getFiles(dir: string): Promise<string[]>`

Traverses a specified directory and retrieves all file paths.

**Parameters:**
- `dir` (string): The directory to traverse

**Returns:**
- `Promise<string[]>`: Array of absolute file paths within the directory

**Example:**
```typescript
import { getFiles } from '@hono-filebased-route/core'

const files = await getFiles('./src/routes')
console.log(files)
// Output: ['/absolute/path/to/src/routes/index.ts', '/absolute/path/to/src/routes/users/[id].ts']
```

**Usage Notes:**
- Only includes TypeScript (`.ts`) and JavaScript (`.js`) files
- Returns absolute paths
- Uses fast-glob for efficient file system traversal

---

#### `getRoutePath(filePath: string, baseDir: string): string`

Converts a file path to a Hono route path following file-based routing conventions.

**Parameters:**
- `filePath` (string): Absolute path of the file
- `baseDir` (string): Absolute path of the routes directory root

**Returns:**
- `string`: Converted Hono route path

**Example:**
```typescript
import { getRoutePath } from '@hono-filebased-route/core'

// Basic route
const route1 = getRoutePath('/project/src/routes/about.ts', '/project/src/routes')
console.log(route1) // '/about'

// Dynamic parameter
const route2 = getRoutePath('/project/src/routes/users/[id].ts', '/project/src/routes')
console.log(route2) // '/users/:id'

// Catch-all route
const route3 = getRoutePath('/project/src/routes/api/[...path].ts', '/project/src/routes')
console.log(route3) // '/api/*'

// Index routes
const route4 = getRoutePath('/project/src/routes/index.ts', '/project/src/routes')
console.log(route4) // '/'

const route5 = getRoutePath('/project/src/routes/blog/index.ts', '/project/src/routes')
console.log(route5) // '/blog'
```

**Route Conversion Rules:**
- `[param]` → `:param` (dynamic parameters)
- `[...param]` → `*` (catch-all routes)
- `index.ts` → `/` (root route)
- `folder/index.ts` → `/folder` (folder index)
- File extensions are removed

---

#### `generateRoutesFile(): Promise<void>`

Generates a TypeScript file that registers all file-based routes with a Hono application.

**Parameters:**
- None (uses predefined constants for configuration)

**Returns:**
- `Promise<void>`: Resolves when the routes file is generated

**Example:**
```typescript
import { generateRoutesFile } from '@hono-filebased-route/core'

// Generate routes file
await generateRoutesFile()

// This creates src/generated-routes.ts with content like:
// export function registerGeneratedRoutes(mainApp: Hono) {
//   // Route registration code
// }
```

**Configuration:**
- **Routes Directory**: `./src/routes` (hardcoded)
- **Output File**: `./src/generated-routes.ts` (hardcoded)
- **Supported Methods**: `GET`, `POST` (hardcoded)

**Generated File Structure:**
```typescript
// THIS FILE IS AUTO-GENERATED. DO NOT EDIT.

import { Hono } from 'hono';
import * as routeModule0 from './routes/index';
import * as routeModule1 from './routes/users/[id]';

export function registerGeneratedRoutes(mainApp: Hono) {
  const honoApprouteModule0 = new Hono();
  honoApprouteModule0.get('/', routeModule0.GET);
  mainApp.route('/', honoApprouteModule0);
  
  const honoApprouteModule1 = new Hono();
  honoApprouteModule1.get('/', routeModule1.GET);
  mainApp.route('/users/:id', honoApprouteModule1);
}
```

---

### `registerGeneratedRoutes(mainApp: Hono): void`

*Note: This function is generated by `generateRoutesFile()` and exported from the generated routes file.*

Registers all generated file-based routes to the main Hono application.

**Parameters:**
- `mainApp` (Hono): The main Hono application instance

**Returns:**
- `void`

**Example:**
```typescript
import { Hono } from 'hono'
import { registerGeneratedRoutes } from './generated-routes'

const app = new Hono()

// Register all file-based routes
registerGeneratedRoutes(app)

// Add global middleware or error handlers
app.notFound((c) => c.text('404 Not Found', 404))
app.onError((err, c) => c.text('Internal Server Error', 500))

export default app
```

## Route File Conventions

### File Structure

Route files should be placed in the `src/routes` directory and follow these naming conventions:

```
src/routes/
├── index.ts          # GET /
├── about.ts          # GET /about
├── users/
│   ├── index.ts      # GET /users
│   ├── [id].ts       # GET /users/:id
│   └── [id]/
│       └── edit.ts   # GET /users/:id/edit
├── api/
│   ├── posts.ts      # GET /api/posts
│   └── [...path].ts  # GET /api/* (catch-all)
└── admin/
    └── dashboard.ts  # GET /admin/dashboard
```

### Route File Format

Each route file should export HTTP method handlers:

```typescript
// routes/users/[id].ts
import type { Context } from 'hono'

// GET handler
export const GET = async (c: Context) => {
  const id = c.req.param('id')
  return c.json({ user: { id, name: `User ${id}` } })
}

// POST handler
export const POST = async (c: Context) => {
  const id = c.req.param('id')
  const body = await c.req.json()
  return c.json({ message: 'User updated', id, data: body })
}
```

### Supported HTTP Methods

Currently supported HTTP methods:
- `GET`
- `POST`

*Note: Support for additional methods (PUT, DELETE, PATCH, etc.) may be added in future versions.*

### Dynamic Routes

#### Single Parameter
```typescript
// routes/users/[id].ts
export const GET = async (c: Context) => {
  const id = c.req.param('id') // Access the dynamic parameter
  return c.json({ userId: id })
}
```

#### Catch-All Routes
```typescript
// routes/api/[...path].ts
export const GET = async (c: Context, pathSegments: string[]) => {
  // pathSegments contains the remaining path parts
  return c.json({ path: pathSegments })
}
```

## Type Definitions

### Route Handler Types

```typescript
import type { Context } from 'hono'

// Standard route handler
type RouteHandler = (c: Context) => Response | Promise<Response>

// Catch-all route handler
type CatchAllHandler = (c: Context, pathSegments: string[]) => Response | Promise<Response>
```

### Configuration Types

```typescript
interface RouteConfig {
  /** Directory containing route files */
  routesDir: string
  /** Output file for generated routes */
  outputFile: string
  /** Supported HTTP methods */
  methods: string[]
}
```

## Error Handling

### Common Errors

#### File System Errors
```typescript
try {
  await generateRoutesFile()
} catch (error) {
  if (error.code === 'ENOENT') {
    console.error('Routes directory not found')
  } else if (error.code === 'EACCES') {
    console.error('Permission denied accessing routes directory')
  }
}
```

#### Route Registration Errors
```typescript
// Invalid route file (missing exports)
// routes/invalid.ts - This will be skipped
export default function() {
  return 'This will not be registered'
}

// Valid route file
// routes/valid.ts
export const GET = (c) => c.text('This will be registered')
```

## Best Practices

### 1. File Organization

```typescript
// ✅ Good - Clear structure
routes/
├── api/
│   ├── auth/
│   │   ├── login.ts
│   │   └── logout.ts
│   └── users/
│       ├── index.ts
│       └── [id].ts
└── pages/
    ├── index.ts
    └── about.ts

// ❌ Avoid - Flat structure for complex apps
routes/
├── api-auth-login.ts
├── api-auth-logout.ts
├── api-users-index.ts
├── api-users-id.ts
├── pages-index.ts
└── pages-about.ts
```

### 2. Route Handler Implementation

```typescript
// ✅ Good - Type-safe and consistent
import type { Context } from 'hono'

export const GET = async (c: Context) => {
  try {
    const data = await fetchData()
    return c.json(data)
  } catch (error) {
    return c.json({ error: 'Internal server error' }, 500)
  }
}

// ❌ Avoid - No error handling
export const GET = async (c: Context) => {
  const data = await fetchData() // May throw
  return c.json(data)
}
```

### 3. Build Process Integration

```json
// package.json
{
  "scripts": {
    "generate-routes": "bun run scripts/generate-routes.ts",
    "predev": "bun run generate-routes",
    "dev": "bun --hot --watch src/main.ts",
    "prestart": "bun run generate-routes",
    "start": "bun src/main.ts",
    "prebuild": "bun run generate-routes",
    "build": "tsc"
  }
}
```

## Migration Guide

### From Manual Route Registration

**Before:**
```typescript
// manual-routes.ts
import { Hono } from 'hono'
import { getUserById, createUser } from './handlers/users'
import { getPosts } from './handlers/posts'

const app = new Hono()

app.get('/users/:id', getUserById)
app.post('/users', createUser)
app.get('/posts', getPosts)

export default app
```

**After:**
```typescript
// src/routes/users/[id].ts
export const GET = async (c) => {
  // getUserById logic here
}

// src/routes/users/index.ts
export const POST = async (c) => {
  // createUser logic here
}

// src/routes/posts/index.ts
export const GET = async (c) => {
  // getPosts logic here
}

// src/main.ts
import { Hono } from 'hono'
import { registerGeneratedRoutes } from './generated-routes'

const app = new Hono()
registerGeneratedRoutes(app)

export default app
```

## Limitations

### Current Limitations

1. **HTTP Methods**: Only `GET` and `POST` are currently supported
2. **Configuration**: Routes directory and output file paths are hardcoded
3. **Middleware**: No built-in support for route-specific middleware (use array syntax)
4. **Nested Catch-All**: Complex nested catch-all patterns may not work as expected

### Planned Features

- Support for all HTTP methods (PUT, DELETE, PATCH, etc.)
- Configurable routes directory and output paths
- Built-in middleware support
- Route-level configuration options
- TypeScript type generation for route parameters

## Troubleshooting

### Common Issues

#### Routes Not Generated
```bash
# Check if routes directory exists
ls -la src/routes

# Verify file extensions
find src/routes -name "*.ts" -o -name "*.js"

# Check for syntax errors in route files
npx tsc --noEmit
```

#### Route Handlers Not Working
```typescript
// ✅ Correct export
export const GET = (c) => c.text('Hello')

// ❌ Incorrect - will be ignored
export default (c) => c.text('Hello')
export function GET(c) { return c.text('Hello') }
const GET = (c) => c.text('Hello')
```

#### Build Errors
```bash
# Regenerate routes file
npm run generate-routes

# Clear TypeScript cache
rm -rf node_modules/.cache
npx tsc --build --clean
```

## Next Steps

- [Configuration Reference](./configuration.md) - Detailed configuration options
- [Type Definitions](./types.md) - Complete type definitions
- [Examples](../examples/basic.md) - Practical usage examples
- [Best Practices](../guide/best-practices.md) - Recommended patterns and practices